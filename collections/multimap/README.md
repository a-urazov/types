# MultiMap

Пакет `multimap` предоставляет реализацию мультикарты (MultiMap) - структуры данных, в которой один ключ может быть сопоставлен с несколькими значениями. Это расширение обычной карты, позволяющее хранить несколько значений для одного ключа.

## Особенности

- **Один ключ - много значений**: каждый ключ может ассоциироваться с несколькими значениями
- **Потокобезопасность**: все операции защищены мьютексом для безопасной работы в многопоточной среде
- **Обобщения**: поддержка любых сравнимых типов ключей и любых типов значений
- **Гибкий API**: полный набор операций для работы с коллекцией ключ-значения
- **Эффективные операции**: большинство операций имеют логарифмическую или константную сложность

## Основные методы

- `New[K comparable, V any]() *MultiMap[K, V]` - создает новую пустую мультикарту
- `Put(key K, value V)` - добавляет значение к списку значений для ключа
- `Get(key K) []V` - возвращает все значения для ключа
- `GetFirst(key K) (V, bool)` - возвращает первое значение для ключа
- `GetLast(key K) (V, bool)` - возвращает последнее значение для ключа
- `Remove(key K, value V) bool` - удаляет конкретное значение для ключа
- `RemoveAll(key K) bool` - удаляет все значения для ключа
- `ContainsKey(key K) bool` - проверяет наличие ключа
- `ContainsValue(value V) bool` - проверяет наличие значения для любого ключа
- `ContainsKeyValue(key K, value V) bool` - проверяет наличие конкретной пары ключ-значение
- `Size() int` - возвращает общее количество пар ключ-значение
- `KeySize() int` - возвращает количество уникальных ключей
- `ValuesSize(key K) int` - возвращает количество значений для ключа
- `IsEmpty() bool` - проверяет, пуста ли мультикарта
- `Clear()` - удаляет все элементы

## Методы итерации

- `Keys() []K` - возвращает все ключи
- `Values() []V` - возвращает все значения
- `Entries() []struct{Key K, Value V}` - возвращает все пары ключ-значение
- `ForEach(fn func(key K, value V))` - итерирует по всем парам ключ-значение
- `ForEachKey(key K, fn func(value V))` - итерирует по значениям конкретного ключа

## Методы модификации

- `ReplaceValues(key K, values []V) []V` - заменяет все значения для ключа
- `PutAll(key K, values []V)` - добавляет несколько значений для ключа
- `Set(key K, value V)` - заменяет все значения для ключа одним значением
- `ToMap() map[K][]V` - возвращает копию внутренней карты

## Пример использования

```go
package main

import (
    "fmt"
    "types/collections/multimap"
)

func main() {
    // Создаем новую мультикарту
    mm := multimap.New[string, string]()
    
    // Добавляем значения
    mm.Put("fruits", "apple")
    mm.Put("fruits", "banana")
    mm.Put("fruits", "cherry")
    mm.Put("vegetables", "carrot")
    mm.Put("vegetables", "broccoli")
    
    // Получаем все значения для ключа
    fruits := mm.Get("fruits")
    fmt.Printf("Fruits: %v\n", fruits) // Fruits: [apple banana cherry]
    
    // Получаем первое и последнее значение
    if first, ok := mm.GetFirst("fruits"); ok {
        fmt.Printf("First fruit: %s\n", first) // First fruit: apple
    }
    if last, ok := mm.GetLast("fruits"); ok {
        fmt.Printf("Last fruit: %s\n", last) // Last fruit: cherry
    }
    
    // Проверяем наличие
    fmt.Printf("Contains 'apple': %t\n", mm.ContainsValue("apple")) // true
    fmt.Printf("Key 'fruits' exists: %t\n", mm.ContainsKey("fruits")) // true
    
    // Удаляем конкретное значение
    if mm.Remove("fruits", "banana") {
        fmt.Println("Removed banana from fruits")
    }
    
    // Итерируем по всем парам
    fmt.Println("All items:")
    mm.ForEach(func(key string, value string) {
        fmt.Printf("  %s: %s\n", key, value)
    })
    
    // Итерируем по значениям конкретного ключа
    fmt.Println("Vegetables:")
    mm.ForEachKey("vegetables", func(value string) {
        fmt.Printf("  %s\n", value)
    })
    
    fmt.Printf("Total items: %d\n", mm.Size()) // Total items: 4
    fmt.Printf("Number of keys: %d\n", mm.KeySize()) // Number of keys: 2
}
```

## Применение

- **Индексация**: создание инвертированных индексов, где один термин может соответствовать нескольким документам
- **Графы**: представление графов, где одна вершина может быть соединена с несколькими другими
- **Кэширование**: хранение нескольких значений для одного ключа кэша
- **Базы данных**: внутренние структуры для представления отношений "один ко многим"
- **Анализ данных**: группировка элементов по категориям
- **Маршрутизация**: сопоставление одного маршрута с несколькими обработчиками

## Реализация

MultiMap реализован как карта, где каждый ключ сопоставлен со срезом значений. Это позволяет эффективно хранить и извлекать несколько значений для одного ключа.

## Производительность

- **Память**: O(n) где n - общее количество пар ключ-значение
- **Put**: O(1) амортизированное время
- **Get**: O(1) для получения всех значений по ключу
- **Remove**: O(k) где k - количество значений для ключа
- **Contains**: O(k) в худшем случае для поиска значения

## Особенности поведения

- **Порядок значений**: значения для каждого ключа сохраняют порядок вставки
- **Копирование**: методы Get и ToMap возвращают копии данных для безопасности
- **Потокобезопасность**: все операции атомарны, но последовательные операции не атомарны
- **Нулевые значения**: поддерживаются значения по умолчанию (zero values)